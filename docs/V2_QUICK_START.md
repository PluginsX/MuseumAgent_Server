# MuseumAgent V2.0 快速启动指南

## 🚀 快速开始

### 1. 启动服务器

```bash
# 进入项目目录
cd e:\Project\Python\MuseumAgent_Server

# 启动服务器
python main.py
```

服务器将在 `http://localhost:8001` 启动。

### 2. 打开客户端

在浏览器中打开：
```
file:///e:/Project/Python/MuseumAgent_Server/client/web/Demo/index.html
```

或使用本地服务器：
```bash
cd client/web/Demo
python -m http.server 8080
```

然后访问：`http://localhost:8080`

### 3. 登录系统

**使用 API Key 登录**：
- 服务器地址：`ws://localhost:8001`
- 认证方式：API Key
- API Key：`test_key_123`（或其他已配置的 key）

**使用账号密码登录**：
- 服务器地址：`ws://localhost:8001`
- 认证方式：账号密码
- 账号：`test_user`
- 密码：`test_password`

### 4. 打开配置面板

点击右上角的 **⚙️ 设置按钮**，打开配置面板。

---

## 🎨 V2.0 新功能体验

### 功能 1：系统提示词配置

**位置**：配置面板 → 系统提示词配置 (V2.0)

**可配置项**：
1. **LLM 角色描述**
   - 定义 AI 助手的角色和身份
   - 例如：`你是博物馆智能助手，专注于文物知识讲解和互动体验。`

2. **LLM 响应要求**
   - 定义 AI 的回答风格和要求
   - 例如：`请用友好、专业的语言回答问题，注重知识性和趣味性的结合。`

**测试步骤**：
1. 修改角色描述为：`你是一位幽默风趣的博物馆讲解员，喜欢用生动的比喻讲解文物。`
2. 修改响应要求为：`请用轻松幽默的语言回答，多用比喻和故事。`
3. 发送消息：`给我介绍一下青铜器`
4. 观察 AI 的回答风格是否变得更加幽默生动

### 功能 2：场景上下文配置

**位置**：配置面板 → 场景上下文配置 (V2.0)

**可配置项**：
1. **场景预设**：快速切换预设场景
2. **当前场景名称**：自定义场景名称
3. **场景描述**：描述当前场景的内容和特点
4. **场景关键词**：用于优化 SRS 检索（逗号分隔）
5. **场景特定提示**：针对当前场景的特殊提示

**预设场景**：
- 公共场景
- 纹样展示场景
- 铸造工艺场景
- 历史文化场景
- 互动体验场景

**测试步骤**：

#### 测试 A：场景预设切换
1. 选择场景预设：`纹样展示场景`
2. 观察配置自动填充：
   - 场景描述：展示中国传统纹样的艺术价值和文化内涵...
   - 关键词：纹样, 艺术, 历史, 文化
   - 场景提示：重点介绍纹样的艺术特点、历史演变和文化象征意义
3. 发送消息：`给我介绍一下龙纹`
4. 观察 AI 是否重点介绍纹样的艺术特点和文化意义

#### 测试 B：切换到铸造工艺场景
1. 选择场景预设：`铸造工艺场景`
2. 发送消息：`青铜器是怎么制作的？`
3. 观察 AI 是否重点介绍铸造技术和工艺流程

#### 测试 C：自定义场景
1. 场景名称：`儿童教育场景`
2. 场景描述：`面向 6-12 岁儿童的文物教育，用简单易懂的语言讲解`
3. 关键词：`儿童, 教育, 简单, 有趣`
4. 场景提示：`用儿童能理解的语言，多用比喻和故事，避免专业术语`
5. 发送消息：`什么是青铜器？`
6. 观察 AI 是否用儿童友好的语言回答

### 功能 3：动态配置更新

**特性**：配置更新后立即生效，无需重新登录

**测试步骤**：
1. 当前场景：`公共场景`
2. 发送消息：`介绍一下文物`（观察回答风格）
3. 切换到：`互动体验场景`
4. 再次发送：`介绍一下文物`（观察回答风格变化）
5. 验证：两次回答的风格应该明显不同

### 功能 4：SRS 检索优化

**特性**：场景关键词用于优化语义检索

**测试步骤**：
1. 场景：`纹样展示场景`
2. 关键词：`纹样, 龙纹, 艺术, 历史`
3. 启用 SRS：确保 `EnableSRS` 开关打开
4. 发送消息：`龙纹有什么特点？`
5. 观察：AI 应该能检索到相关的纹样知识并给出详细回答

---

## 🔍 验证架构工作流程

### 完整流程测试

**目标**：验证从客户端配置到服务器 LLM 调用的完整流程

**步骤**：

1. **配置阶段**
   ```
   打开配置面板
   ├─ 设置系统提示词
   │  ├─ 角色描述：你是博物馆智能助手
   │  └─ 响应要求：请用友好、专业的语言回答
   └─ 设置场景上下文
      ├─ 场景：纹样展示场景
      ├─ 描述：展示中国传统纹样...
      ├─ 关键词：纹样, 艺术, 历史
      └─ 提示：重点介绍纹样的艺术特点
   ```

2. **发送请求**
   ```
   用户输入：给我介绍一下龙纹的演变历史
   ```

3. **服务器处理**（查看服务器日志）
   ```
   [会话管理器] 获取会话配置
   ├─ system_prompt: {...}
   └─ scene_context: {...}
   
   [SRS 服务] 语义检索
   ├─ 关键词：纹样, 艺术, 历史
   └─ 检索结果：3 条相关文档
   
   [LLM 客户端] 构建提示词
   ├─ 系统消息：你是博物馆智能助手...
   └─ 用户消息：
      ├─ [场景描述] 展示中国传统纹样...
      ├─ [场景提示] 重点介绍纹样的艺术特点...
      ├─ [检索结果] 根据检索，龙纹是...
      └─ [用户输入] 给我介绍一下龙纹的演变历史
   
   [LLM API] 发送请求
   └─ 返回流式响应
   ```

4. **客户端接收**
   ```
   接收文本流
   └─ 显示在聊天窗口
   ```

### 日志验证点

**服务器日志应包含**：

```
[会话管理器] Session registered (function count: 0)
  session_id: sess_xxx
  functions: 普通对话模式

[WebSocket] Updated system_prompt from request
  session_id: sess_xxx
  request_id: req_xxx

[WebSocket] Updated scene_context from request
  session_id: sess_xxx
  scene: 纹样展示场景

[LLM客户端] Building prompt from session config
  session_id: sess_xxx
  has_system_prompt: True
  has_scene_context: True

[LLM客户端] System message built
  length: 150 chars

[LLM客户端] User message built
  scene: 纹样展示场景
  has_rag: True
  rag_count: 3
  length: 500 chars
```

---

## 🧪 测试场景示例

### 场景 1：博物馆导览助手

**配置**：
```javascript
系统提示词：
  角色描述：你是博物馆智能导览助手，熟悉馆内所有展品和路线。
  响应要求：请用热情友好的语言回答，像真人导览员一样。

场景上下文：
  场景：公共场景
  描述：博物馆公共展示区域
  关键词：文物, 历史, 文化, 导览
  提示：提供清晰的展品介绍和参观建议
```

**测试对话**：
```
用户：你好，我想参观青铜器展区
AI：[应该热情地介绍青铜器展区的位置和特色]

用户：有什么推荐的展品吗？
AI：[应该推荐重点展品并说明理由]
```

### 场景 2：文物修复专家

**配置**：
```javascript
系统提示词：
  角色描述：你是文物修复专家，精通各种文物的修复技术和保护方法。
  响应要求：请用专业严谨的语言回答，注重技术细节。

场景上下文：
  场景：铸造工艺场景
  描述：展示青铜器的铸造工艺和修复技术
  关键词：修复, 保护, 工艺, 技术
  提示：重点介绍修复技术和保护方法
```

**测试对话**：
```
用户：青铜器生锈了怎么修复？
AI：[应该详细介绍修复技术和步骤]

用户：修复过程中要注意什么？
AI：[应该强调技术要点和注意事项]
```

### 场景 3：儿童教育助手

**配置**：
```javascript
系统提示词：
  角色描述：你是儿童教育助手，擅长用简单有趣的方式讲解文物知识。
  响应要求：请用儿童能理解的语言，多用比喻和故事，避免专业术语。

场景上下文：
  场景：互动体验场景
  描述：面向儿童的互动式文物体验
  关键词：儿童, 教育, 有趣, 互动
  提示：用生动的比喻和故事讲解，引导儿童参与
```

**测试对话**：
```
用户：什么是青铜器？
AI：[应该用儿童友好的语言，可能用比喻解释]

用户：古人为什么要做青铜器？
AI：[应该讲一个简单的故事来解释]
```

---

## 📊 性能监控

### 关键指标

1. **配置传输**
   - 注册消息大小：< 5KB
   - 配置更新延迟：< 100ms

2. **提示词构建**
   - 构建耗时：< 50ms
   - 提示词长度：500-2000 tokens

3. **端到端延迟**
   - 从发送到首个响应：< 2s
   - 完整响应时间：< 10s

### 监控方法

**浏览器控制台**：
```javascript
// 查看发送的消息
console.log('[WebSocket] Sending:', message);

// 查看接收的消息
console.log('[WebSocket] Received:', message);

// 查看配置更新
console.log('[SettingsPanel] Config updated:', config);
```

**服务器日志**：
```bash
# 实时查看日志
tail -f logs/app.log

# 过滤特定日志
grep "system_prompt" logs/app.log
grep "scene_context" logs/app.log
grep "Building prompt" logs/app.log
```

---

## 🐛 常见问题

### Q1: 配置更新后没有生效？

**检查**：
1. 确认配置面板显示的值已更新
2. 查看浏览器控制台是否有错误
3. 查看服务器日志是否收到更新请求
4. 尝试发送新消息触发更新

**解决**：
- 刷新页面重新登录
- 检查网络连接
- 查看服务器日志排查问题

### Q2: 场景切换后回答风格没变化？

**原因**：
- LLM 可能需要几轮对话才能适应新场景
- 场景描述可能不够明确

**解决**：
- 使场景描述更加具体
- 在场景特定提示中明确要求
- 多发送几条消息观察效果

### Q3: SRS 检索结果不准确？

**检查**：
1. 确认 EnableSRS 开关已打开
2. 检查场景关键词是否合适
3. 查看服务器日志中的检索结果

**优化**：
- 调整场景关键词
- 使用更具体的关键词
- 确保知识库中有相关内容

### Q4: 服务器日志中没有看到配置信息？

**检查**：
1. 确认服务器正在运行
2. 检查日志级别设置
3. 查看是否有错误日志

**解决**：
```python
# 调整日志级别（在配置文件中）
LOG_LEVEL = "DEBUG"
```

---

## 📝 开发调试

### 客户端调试

**浏览器控制台**：
```javascript
// 查看当前配置
console.log(window.app.client.config);

// 查看会话信息
console.log(window.app.client.sessionId);

// 手动更新配置
window.app.client.config.systemPrompt = {
  role_description: "测试角色",
  response_requirements: "测试要求"
};
```

### 服务器调试

**Python 调试**：
```python
# 在 dynamic_llm_client.py 中添加断点
async def generate_response(self, session_id, user_input, ...):
    session = strict_session_manager.get_session(session_id)
    print(f"[DEBUG] Session config: {session.client_metadata}")
    # 继续执行...
```

**日志增强**：
```python
# 在关键位置添加详细日志
logger.info("Detailed config", {
    "system_prompt": system_prompt,
    "scene_context": scene_context,
    "prompt_length": len(final_prompt)
})
```

---

## 🎯 下一步

1. **完成功能测试**
   - 测试所有场景预设
   - 测试配置更新
   - 测试 SRS 检索

2. **性能优化**
   - 监控响应时间
   - 优化提示词长度
   - 调整 LLM 参数

3. **用户体验优化**
   - 收集用户反馈
   - 优化配置界面
   - 添加使用提示

4. **生产部署**
   - 配置生产环境
   - 设置监控告警
   - 准备运维文档

---

## 📚 相关文档

- [V2.0 架构验证报告](./V2_ARCHITECTURE_VERIFICATION.md)
- [完整架构文档](./COMPLETE_ARCHITECTURE.md)
- [通信协议文档](./CommunicationProtocol_CS.md)
- [实现完成报告](./IMPLEMENTATION_COMPLETE.md)

---

**祝测试顺利！** 🎉

如有问题，请查看日志或联系开发团队。

