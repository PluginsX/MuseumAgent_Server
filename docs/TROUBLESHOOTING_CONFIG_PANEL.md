# é…ç½®é¢æ¿é—®é¢˜æ’æŸ¥æŒ‡å—

## ğŸ” é—®é¢˜æè¿°
ç”¨æˆ·åé¦ˆï¼šå®¢æˆ·ç«¯é…ç½®é¢æ¿å¹¶æ— ä»»ä½•æ–°å¢é…ç½®å†…å®¹

## âœ… ä»£ç éªŒè¯ç»“æœ

### 1. SettingsPanel.js - å·²å®Œæ•´å®ç° âœ…

**æ–‡ä»¶ä½ç½®**: `client/web/Demo/src/components/SettingsPanel.js`

**å·²å®ç°åŠŸèƒ½**:
- âœ… ç³»ç»Ÿæç¤ºè¯é…ç½®ï¼ˆç¬¬ 130-160 è¡Œï¼‰
  - `renderSystemPromptSettings()` æ–¹æ³•
  - è§’è‰²æè¿°è¾“å…¥æ¡†
  - å“åº”è¦æ±‚è¾“å…¥æ¡†
  
- âœ… åœºæ™¯ä¸Šä¸‹æ–‡é…ç½®ï¼ˆç¬¬ 162-220 è¡Œï¼‰
  - `renderSceneContextSettings()` æ–¹æ³•
  - åœºæ™¯é¢„è®¾ä¸‹æ‹‰é€‰æ‹©å™¨
  - å½“å‰åœºæ™¯åç§°
  - åœºæ™¯æè¿°
  - åœºæ™¯å…³é”®è¯
  - åœºæ™¯ç‰¹å®šæç¤º

- âœ… 5 ä¸ªåœºæ™¯é¢„è®¾ï¼ˆç¬¬ 125-165 è¡Œï¼‰
  - å…¬å…±åœºæ™¯
  - çº¹æ ·å±•ç¤ºåœºæ™¯
  - é“¸é€ å·¥è‰ºåœºæ™¯
  - å†å²æ–‡åŒ–åœºæ™¯
  - äº’åŠ¨ä½“éªŒåœºæ™¯

- âœ… é…ç½®æ›´æ–°é€»è¾‘ï¼ˆç¬¬ 690-750 è¡Œï¼‰
  - `updateConfig()` æ–¹æ³•
  - æ”¯æŒ systemPrompt æ›´æ–°
  - æ”¯æŒ sceneContext æ›´æ–°
  - åœºæ™¯é¢„è®¾åˆ‡æ¢

- âœ… æ¸²æŸ“æµç¨‹ï¼ˆç¬¬ 180-220 è¡Œï¼‰
  ```javascript
  render() {
    // ...
    // 1. å®¢æˆ·ç«¯åŸºæœ¬ä¿¡æ¯
    const basicSection = this.renderBasicSettings();
    content.appendChild(basicSection);

    // âœ… 2. ç³»ç»Ÿæç¤ºè¯é…ç½®
    const systemPromptSection = this.renderSystemPromptSettings();
    content.appendChild(systemPromptSection);

    // âœ… 3. åœºæ™¯ä¸Šä¸‹æ–‡é…ç½®
    const sceneContextSection = this.renderSceneContextSettings();
    content.appendChild(sceneContextSection);

    // 4. VADé…ç½®
    const vadSection = this.renderVADSettings();
    content.appendChild(vadSection);
    // ...
  }
  ```

### 2. MuseumAgentSDK.js - å·²å®Œæ•´å®ç° âœ…

**æ–‡ä»¶ä½ç½®**: `client/web/Demo/lib/MuseumAgentSDK.js`

**å·²å®ç°åŠŸèƒ½**:
- âœ… é…ç½®ç»“æ„æ‰©å±•ï¼ˆç¬¬ 60-80 è¡Œï¼‰
  ```javascript
  this.config = {
    // ... åŸæœ‰é…ç½®
    systemPrompt: config.systemPrompt || {
      role_description: 'ä½ æ˜¯åšç‰©é¦†æ™ºèƒ½åŠ©æ‰‹...',
      response_requirements: 'è¯·ç”¨å‹å¥½ã€ä¸“ä¸šçš„è¯­è¨€å›ç­”é—®é¢˜ã€‚'
    },
    sceneContext: config.sceneContext || {
      current_scene: 'å…¬å…±åœºæ™¯',
      scene_description: 'åšç‰©é¦†å…¬å…±å±•ç¤ºåŒºåŸŸ',
      keywords: ['æ–‡ç‰©', 'å†å²', 'æ–‡åŒ–'],
      scene_specific_prompt: ''
    }
  };
  ```

- âœ… connect æ–¹æ³•æ›´æ–°ï¼ˆç¬¬ 185-195 è¡Œï¼‰
  ```javascript
  const result = await this.wsClient.register(
    authData,
    this.config.platform,
    this.config.requireTTS,
    this.config.enableSRS,
    this.config.functionCalling,
    this.config.systemPrompt,      // âœ… V2.0
    this.config.sceneContext       // âœ… V2.0
  );
  ```

### 3. WebSocketClient.js - å·²å®Œæ•´å®ç° âœ…

**æ–‡ä»¶ä½ç½®**: `client/web/Demo/lib/core/WebSocketClient.js`

**å·²å®ç°åŠŸèƒ½**:
- âœ… register æ–¹æ³•æ‰©å±•ï¼ˆç¬¬ 78-110 è¡Œï¼‰
  ```javascript
  async register(authData, platform, requireTTS, enableSRS, 
                 functionCalling, systemPrompt, sceneContext) {
    const message = {
      version: '1.0',
      msg_type: 'REGISTER',
      session_id: null,
      payload: {
        auth: authData,
        platform: platform,
        require_tts: requireTTS,
        enable_srs: enableSRS,
        function_calling: functionCalling
      },
      timestamp: Date.now()
    };

    // âœ… V2.0: æ·»åŠ ç³»ç»Ÿæç¤ºè¯é…ç½®
    if (systemPrompt) {
      message.payload.system_prompt = systemPrompt;
    }

    // âœ… V2.0: æ·»åŠ åœºæ™¯ä¸Šä¸‹æ–‡é…ç½®
    if (sceneContext) {
      message.payload.scene_context = sceneContext;
    }
    // ...
  }
  ```

### 4. æ ·å¼æ–‡ä»¶ - å·²å®Œæ•´å®ç° âœ…

**æ–‡ä»¶ä½ç½®**: `client/web/Demo/src/styles.css`

**å·²å®ç°æ ·å¼**:
- âœ… `.settings-panel` - é…ç½®é¢æ¿å®¹å™¨
- âœ… `.settings-header` - é…ç½®é¢æ¿å¤´éƒ¨
- âœ… `.settings-content` - é…ç½®é¢æ¿å†…å®¹åŒº
- âœ… `.settings-section` - é…ç½®åŒºåŸŸ
- âœ… `.form-group` - è¡¨å•ç»„
- âœ… `.form-control` - è¡¨å•æ§ä»¶
- âœ… å“åº”å¼å¸ƒå±€

### 5. åº”ç”¨é›†æˆ - å·²å®Œæ•´å®ç° âœ…

**æ–‡ä»¶ä½ç½®**: `client/web/Demo/src/app.js`

**å·²å®ç°åŠŸèƒ½**:
- âœ… è®¾ç½®æŒ‰é’®ï¼ˆç¬¬ 220-235 è¡Œï¼‰
- âœ… é…ç½®é¢æ¿åŠ¨æ€åŠ è½½
- âœ… å…¨å±€å®ä¾‹ç®¡ç†

---

## ğŸ› å¯èƒ½çš„é—®é¢˜åŸå› 

### åŸå›  1: æµè§ˆå™¨ç¼“å­˜ â­â­â­â­â­
**æœ€å¯èƒ½çš„åŸå› **

**ç—‡çŠ¶**: 
- ä»£ç å·²æ›´æ–°ï¼Œä½†æµè§ˆå™¨æ˜¾ç¤ºæ—§ç‰ˆæœ¬
- é…ç½®é¢æ¿æ²¡æœ‰æ–°å¢åŒºåŸŸ

**è§£å†³æ–¹æ³•**:
1. **ç¡¬åˆ·æ–°é¡µé¢**
   - Windows: `Ctrl + Shift + R` æˆ– `Ctrl + F5`
   - Mac: `Cmd + Shift + R`

2. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**
   - Chrome: F12 â†’ Network â†’ å‹¾é€‰ "Disable cache"
   - æˆ–è€…: è®¾ç½® â†’ éšç§å’Œå®‰å…¨ â†’ æ¸…é™¤æµè§ˆæ•°æ®

3. **ä½¿ç”¨æ— ç—•æ¨¡å¼**
   - Chrome: `Ctrl + Shift + N`
   - Firefox: `Ctrl + Shift + P`

### åŸå›  2: æ–‡ä»¶è·¯å¾„é—®é¢˜ â­â­â­
**å¯èƒ½æ€§è¾ƒé«˜**

**ç—‡çŠ¶**:
- æ§åˆ¶å°æ˜¾ç¤º 404 é”™è¯¯
- æ¨¡å—åŠ è½½å¤±è´¥

**æ£€æŸ¥æ–¹æ³•**:
```javascript
// æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å° (F12)
// æŸ¥çœ‹æ˜¯å¦æœ‰ç±»ä¼¼é”™è¯¯:
// Failed to load module script: Expected a JavaScript module script...
// 404 Not Found: /src/components/SettingsPanel.js
```

**è§£å†³æ–¹æ³•**:
1. ç¡®è®¤æ–‡ä»¶è·¯å¾„æ­£ç¡®
2. æ£€æŸ¥æ–‡ä»¶åå¤§å°å†™
3. ç¡®è®¤æ–‡ä»¶ç¡®å®å­˜åœ¨

### åŸå›  3: JavaScript é”™è¯¯ â­â­â­
**å¯èƒ½æ€§ä¸­ç­‰**

**ç—‡çŠ¶**:
- é…ç½®é¢æ¿æ‰“ä¸å¼€
- æ§åˆ¶å°æœ‰é”™è¯¯ä¿¡æ¯

**æ£€æŸ¥æ–¹æ³•**:
```javascript
// æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å° (F12)
// æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯:
// Uncaught TypeError: ...
// Uncaught ReferenceError: ...
```

**è§£å†³æ–¹æ³•**:
1. æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥ç›¸å…³ä»£ç 
3. ç¡®è®¤æ‰€æœ‰ä¾èµ–å·²åŠ è½½

### åŸå›  4: æ¨¡å—å¯¼å…¥é—®é¢˜ â­â­
**å¯èƒ½æ€§è¾ƒä½**

**ç—‡çŠ¶**:
- SettingsPanel ç±»æœªå®šä¹‰
- å¯¼å…¥å¤±è´¥

**æ£€æŸ¥æ–¹æ³•**:
```javascript
// åœ¨æ§åˆ¶å°è¾“å…¥:
console.log(window.settingsPanel);
// åº”è¯¥æ˜¾ç¤º SettingsPanel å®ä¾‹æˆ– undefined
```

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥ import è¯­å¥
2. ç¡®è®¤æ¨¡å—å¯¼å‡ºæ­£ç¡®
3. æ£€æŸ¥æ–‡ä»¶æ‰©å±•å (.js)

---

## ğŸ”§ æ’æŸ¥æ­¥éª¤

### æ­¥éª¤ 1: éªŒè¯æ–‡ä»¶å­˜åœ¨
```powershell
# åœ¨ PowerShell ä¸­æ‰§è¡Œ
Test-Path "e:\Project\Python\MuseumAgent_Server\client\web\Demo\src\components\SettingsPanel.js"
# åº”è¯¥è¿”å›: True
```

### æ­¥éª¤ 2: æ£€æŸ¥æ–‡ä»¶å†…å®¹
```powershell
# æœç´¢å…³é”®æ–¹æ³•
Select-String -Path "e:\Project\Python\MuseumAgent_Server\client\web\Demo\src\components\SettingsPanel.js" -Pattern "renderSystemPromptSettings"
# åº”è¯¥æ‰¾åˆ°è¯¥æ–¹æ³•
```

### æ­¥éª¤ 3: ä½¿ç”¨æµ‹è¯•é¡µé¢
1. æ‰“å¼€æµ‹è¯•é¡µé¢:
   ```
   file:///e:/Project/Python/MuseumAgent_Server/client/web/Demo/test_settings.html
   ```

2. ç‚¹å‡»"æ‰“å¼€é…ç½®é¢æ¿"æŒ‰é’®

3. æ£€æŸ¥æ˜¯å¦æ˜¾ç¤º:
   - âœ… ç³»ç»Ÿæç¤ºè¯é…ç½® (V2.0)
   - âœ… åœºæ™¯ä¸Šä¸‹æ–‡é…ç½® (V2.0)
   - âœ… 5 ä¸ªåœºæ™¯é¢„è®¾

### æ­¥éª¤ 4: æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
1. æ‰“å¼€æ§åˆ¶å° (F12)
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾
3. æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
4. æŸ¥çœ‹æ˜¯å¦æœ‰åŠ è½½æ—¥å¿—:
   ```
   [Test] å®¢æˆ·ç«¯é…ç½®: {...}
   [Test] æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ
   [Test] ç‚¹å‡»æŒ‰é’®æ‰“å¼€é…ç½®é¢æ¿
   ```

### æ­¥éª¤ 5: æ£€æŸ¥ç½‘ç»œè¯·æ±‚
1. æ‰“å¼€æ§åˆ¶å° (F12)
2. åˆ‡æ¢åˆ° Network æ ‡ç­¾
3. åˆ·æ–°é¡µé¢
4. æ£€æŸ¥ SettingsPanel.js æ˜¯å¦æˆåŠŸåŠ è½½
5. æŸ¥çœ‹çŠ¶æ€ç ï¼ˆåº”è¯¥æ˜¯ 200ï¼‰

---

## ğŸ¯ å¿«é€Ÿæµ‹è¯•æ–¹æ¡ˆ

### æ–¹æ¡ˆ A: ä½¿ç”¨æµ‹è¯•é¡µé¢ï¼ˆæ¨èï¼‰

1. **æ‰“å¼€æµ‹è¯•é¡µé¢**
   ```
   file:///e:/Project/Python/MuseumAgent_Server/client/web/Demo/test_settings.html
   ```

2. **ç‚¹å‡»æŒ‰é’®**
   - ç‚¹å‡»"æ‰“å¼€é…ç½®é¢æ¿"

3. **éªŒè¯åŠŸèƒ½**
   - æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºæ–°å¢åŒºåŸŸ
   - å°è¯•åˆ‡æ¢åœºæ™¯é¢„è®¾
   - æŸ¥çœ‹é…ç½®æ˜¯å¦å®æ—¶æ›´æ–°

### æ–¹æ¡ˆ B: ä½¿ç”¨ä¸»åº”ç”¨

1. **æ¸…é™¤ç¼“å­˜**
   - ç¡¬åˆ·æ–°: `Ctrl + Shift + R`
   - æˆ–ä½¿ç”¨æ— ç—•æ¨¡å¼

2. **æ‰“å¼€ä¸»åº”ç”¨**
   ```
   file:///e:/Project/Python/MuseumAgent_Server/client/web/Demo/index.html
   ```

3. **ç™»å½•ç³»ç»Ÿ**
   - ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•

4. **æ‰“å¼€é…ç½®é¢æ¿**
   - ç‚¹å‡»å³ä¸Šè§’ âš™ï¸ æŒ‰é’®

5. **éªŒè¯åŠŸèƒ½**
   - å‘ä¸‹æ»šåŠ¨æŸ¥çœ‹æ–°å¢åŒºåŸŸ
   - åº”è¯¥åœ¨"å®¢æˆ·ç«¯åŸºæœ¬ä¿¡æ¯"ä¹‹å

---

## ğŸ“‹ éªŒè¯æ¸…å•

### ä»£ç å±‚é¢ âœ…
- [x] SettingsPanel.js åŒ…å«æ–°æ–¹æ³•
- [x] MuseumAgentSDK.js åŒ…å«æ–°é…ç½®
- [x] WebSocketClient.js æ”¯æŒæ–°å‚æ•°
- [x] styles.css åŒ…å«æ ·å¼
- [x] app.js é›†æˆé…ç½®é¢æ¿

### åŠŸèƒ½å±‚é¢ â¬œ
- [ ] é…ç½®é¢æ¿èƒ½æ­£å¸¸æ‰“å¼€
- [ ] æ˜¾ç¤º"ç³»ç»Ÿæç¤ºè¯é…ç½® (V2.0)"
- [ ] æ˜¾ç¤º"åœºæ™¯ä¸Šä¸‹æ–‡é…ç½® (V2.0)"
- [ ] æ˜¾ç¤º 5 ä¸ªåœºæ™¯é¢„è®¾
- [ ] åœºæ™¯åˆ‡æ¢åŠŸèƒ½æ­£å¸¸
- [ ] é…ç½®å®æ—¶æ›´æ–°

### æµè§ˆå™¨å±‚é¢ â¬œ
- [ ] æ¸…é™¤äº†æµè§ˆå™¨ç¼“å­˜
- [ ] æ²¡æœ‰ JavaScript é”™è¯¯
- [ ] æ‰€æœ‰æ–‡ä»¶æˆåŠŸåŠ è½½
- [ ] æ§åˆ¶å°æ²¡æœ‰ 404 é”™è¯¯

---

## ğŸ’¡ å»ºè®®æ“ä½œ

### ç«‹å³æ‰§è¡Œ:

1. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**
   ```
   Chrome: Ctrl + Shift + Delete
   é€‰æ‹©: ç¼“å­˜çš„å›¾ç‰‡å’Œæ–‡ä»¶
   æ—¶é—´èŒƒå›´: å…¨éƒ¨æ—¶é—´
   ç‚¹å‡»: æ¸…é™¤æ•°æ®
   ```

2. **ä½¿ç”¨æµ‹è¯•é¡µé¢éªŒè¯**
   ```
   æ‰“å¼€: test_settings.html
   ç‚¹å‡»: æ‰“å¼€é…ç½®é¢æ¿
   æ£€æŸ¥: æ˜¯å¦æ˜¾ç¤ºæ–°å¢åŒºåŸŸ
   ```

3. **å¦‚æœæµ‹è¯•é¡µé¢æ­£å¸¸ï¼Œä¸»åº”ç”¨ä¸æ­£å¸¸**
   - è¯´æ˜æ˜¯ç¼“å­˜é—®é¢˜
   - ç»§ç»­æ¸…é™¤ç¼“å­˜
   - ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•

4. **å¦‚æœæµ‹è¯•é¡µé¢ä¹Ÿä¸æ­£å¸¸**
   - æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
   - æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
   - æˆªå›¾å‘é€ç»™æˆ‘

---

## ğŸ“¸ é¢„æœŸæ•ˆæœ

### é…ç½®é¢æ¿åº”è¯¥æ˜¾ç¤º:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¢æˆ·ç«¯é…ç½®                        Ã—    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  å®¢æˆ·ç«¯åŸºæœ¬ä¿¡æ¯                         â”‚
â”‚  â”œâ”€ Platform                            â”‚
â”‚  â”œâ”€ RequireTTS                          â”‚
â”‚  â”œâ”€ EnableSRS                           â”‚
â”‚  â”œâ”€ AutoPlay                            â”‚
â”‚  â””â”€ FunctionCalling                     â”‚
â”‚                                         â”‚
â”‚  ç³»ç»Ÿæç¤ºè¯é…ç½® (V2.0)          â† æ–°å¢  â”‚
â”‚  â”œâ”€ LLM è§’è‰²æè¿°                        â”‚
â”‚  â””â”€ LLM å“åº”è¦æ±‚                        â”‚
â”‚                                         â”‚
â”‚  åœºæ™¯ä¸Šä¸‹æ–‡é…ç½® (V2.0)          â† æ–°å¢  â”‚
â”‚  â”œâ”€ åœºæ™¯é¢„è®¾                            â”‚
â”‚  â”œâ”€ å½“å‰åœºæ™¯åç§°                        â”‚
â”‚  â”œâ”€ åœºæ™¯æè¿°                            â”‚
â”‚  â”œâ”€ åœºæ™¯å…³é”®è¯                          â”‚
â”‚  â””â”€ åœºæ™¯ç‰¹å®šæç¤º                        â”‚
â”‚                                         â”‚
â”‚  å®¢æˆ·ç«¯è¯­éŸ³é‡‡é›†VADé…ç½®                  â”‚
â”‚  â””â”€ ...                                 â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ†˜ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯:

1. **æµè§ˆå™¨ä¿¡æ¯**
   - æµè§ˆå™¨ç±»å‹å’Œç‰ˆæœ¬
   - æ“ä½œç³»ç»Ÿ

2. **æ§åˆ¶å°æˆªå›¾**
   - F12 æ‰“å¼€æ§åˆ¶å°
   - Console æ ‡ç­¾çš„å†…å®¹
   - Network æ ‡ç­¾çš„å†…å®¹

3. **æµ‹è¯•ç»“æœ**
   - test_settings.html æ˜¯å¦æ­£å¸¸
   - ä¸»åº”ç”¨æ˜¯å¦æ­£å¸¸
   - å…·ä½“çœ‹åˆ°äº†ä»€ä¹ˆ

4. **é”™è¯¯ä¿¡æ¯**
   - ä»»ä½•çº¢è‰²é”™è¯¯ä¿¡æ¯
   - 404 é”™è¯¯
   - JavaScript é”™è¯¯

---

**æ–‡æ¡£ç‰ˆæœ¬**: V1.0  
**åˆ›å»ºæ—¶é—´**: 2026-02-20  
**çŠ¶æ€**: å¾…ç”¨æˆ·åé¦ˆæµ‹è¯•ç»“æœ

