# STT PCM æ ¼å¼ç»Ÿä¸€ - æœ€ç»ˆä¿®å¤æ–¹æ¡ˆ

## é—®é¢˜æ€»ç»“

STT è¯†åˆ«å¤±è´¥çš„æ ¹æœ¬åŸå› ï¼š**å®¢æˆ·ç«¯å‘é€ PCM éŸ³é¢‘æ•°æ®æ—¶ï¼Œæ²¡æœ‰åœ¨åè®®æ¶ˆæ¯ä¸­æ˜ç¡®æŒ‡å®šéŸ³é¢‘æ ¼å¼**ï¼Œå¯¼è‡´æœåŠ¡å™¨æ— æ³•æ­£ç¡®è¯†åˆ«ã€‚

## å®Œæ•´ä¿®å¤

### ä¿®å¤ 1ï¼šå®¢æˆ·ç«¯æ·»åŠ æ ¼å¼æ ‡è¯† âœ…

**æ–‡ä»¶**: `client/web/Demo/src/core/WebSocketClient.js`

**ä¿®æ”¹ä½ç½® 1**: èµ·å§‹å¸§ï¼ˆç¬¬ 220 è¡Œï¼‰

```javascript
// ä¿®å¤å‰
const startMessage = {
    payload: {
        content: { voice_mode: 'BINARY' }  // âŒ ç¼ºå°‘æ ¼å¼
    }
};

// ä¿®å¤å
const startMessage = {
    payload: {
        content: { 
            voice_mode: 'BINARY',
            audio_format: 'pcm'  // âœ… æ˜ç¡®æŒ‡å®š PCM
        }
    }
};
```

**ä¿®æ”¹ä½ç½® 2**: ç»“æŸå¸§ï¼ˆç¬¬ 250 è¡Œï¼‰

```javascript
// ä¿®å¤å‰
const endMessage = {
    payload: {
        content: { voice_mode: 'BINARY' }  // âŒ ç¼ºå°‘æ ¼å¼
    }
};

// ä¿®å¤å
const endMessage = {
    payload: {
        content: { 
            voice_mode: 'BINARY',
            audio_format: 'pcm'  // âœ… æ˜ç¡®æŒ‡å®š PCM
        }
    }
};
```

---

### ä¿®å¤ 2ï¼šæœåŠ¡å™¨ç«¯æ ¼å¼æå–å’Œä¿å­˜ âœ…

**æ–‡ä»¶**: `src/ws/agent_handler.py`

**ä¿®æ”¹ä½ç½®**: ç¬¬ 140-180 è¡Œ

```python
# ä¿®å¤å‰
if stream_seq == 0:
    active_voice_request[session_id] = request_id
    voice_buffer[request_id] = b""
elif stream_seq == -1:
    audio = voice_buffer.pop(request_id, b"")
    audio_format_hint = content.get("audio_format")  # âš ï¸ å¯èƒ½ä¸º None

# ä¿®å¤å
if stream_seq == 0:
    # èµ·å§‹å¸§ï¼šæå–å¹¶ä¿å­˜éŸ³é¢‘æ ¼å¼
    audio_format_hint = content.get("audio_format", "pcm")  # âœ… é»˜è®¤ PCM
    active_voice_request[session_id] = request_id
    voice_buffer[request_id] = b""
    
    # ä¿å­˜æ ¼å¼æç¤ºï¼ˆç”¨äºç»“æŸå¸§ï¼‰
    if not hasattr(voice_buffer, '_format_hints'):
        voice_buffer._format_hints = {}
    voice_buffer._format_hints[request_id] = audio_format_hint
    
    logger.ws.info("Voice stream started", {
        "request_id": request_id[:16],
        "audio_format": audio_format_hint
    })
    
elif stream_seq == -1:
    # ç»“æŸå¸§ï¼šè·å–ä¿å­˜çš„æ ¼å¼æç¤º
    audio = voice_buffer.pop(request_id, b"")
    
    audio_format_hint = None
    if hasattr(voice_buffer, '_format_hints'):
        audio_format_hint = voice_buffer._format_hints.pop(request_id, None)
    
    # å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ ¼å¼ï¼Œå°è¯•ä»ç»“æŸå¸§è·å–
    if not audio_format_hint:
        audio_format_hint = content.get("audio_format", "pcm")  # âœ… é»˜è®¤ PCM
    
    logger.ws.info("Voice stream ended", {
        "request_id": request_id[:16],
        "audio_size": len(audio),
        "audio_format": audio_format_hint
    })
```

**å…³é”®æ”¹è¿›**ï¼š
1. âœ… åœ¨èµ·å§‹å¸§æå– `audio_format`ï¼Œé»˜è®¤ä¸º `'pcm'`
2. âœ… å°†æ ¼å¼æç¤ºä¿å­˜åˆ° `voice_buffer._format_hints` å­—å…¸
3. âœ… åœ¨ç»“æŸå¸§ä»ä¿å­˜çš„å­—å…¸ä¸­è·å–æ ¼å¼
4. âœ… æ·»åŠ è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•

---

### ä¿®å¤ 3ï¼šæ·»åŠ äºŒè¿›åˆ¶æ•°æ®æ¥æ”¶æ—¥å¿— âœ…

**æ–‡ä»¶**: `src/ws/agent_handler.py`

**ä¿®æ”¹ä½ç½®**: ç¬¬ 280 è¡Œ

```python
# ä¿®å¤å‰
if "bytes" in raw:
    data = raw["bytes"]
    if isinstance(data, bytes) and session_id:
        rid = active_voice_request.get(session_id)
        if rid:
            voice_buffer[rid] = voice_buffer.get(rid, b"") + data
    continue

# ä¿®å¤å
if "bytes" in raw:
    data = raw["bytes"]
    if isinstance(data, bytes) and session_id:
        rid = active_voice_request.get(session_id)
        if rid:
            voice_buffer[rid] = voice_buffer.get(rid, b"") + data
            logger.ws.debug("Received audio chunk", {
                "request_id": rid[:16],
                "chunk_size": len(data),
                "total_size": len(voice_buffer[rid])
            })
    continue
```

---

## å®Œæ•´æ•°æ®æµï¼ˆä¿®å¤åï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å®¢æˆ·ç«¯é‡‡é›† (AudioService.js)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AudioContext (16kHz, 16bit, mono)                               â”‚
â”‚ â†“                                                                â”‚
â”‚ ScriptProcessor.onaudioprocess                                  â”‚
â”‚ â†“                                                                â”‚
â”‚ è½¬æ¢ä¸º Int16Array PCM (å°ç«¯åº)                                   â”‚
â”‚ â†“                                                                â”‚
â”‚ è¾“å‡º: ArrayBuffer (PCM è£¸æ•°æ®)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å®¢æˆ·ç«¯åŒ…è£… (ChatWindow.js)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆ›å»º ReadableStream                                              â”‚
â”‚ â†“                                                                â”‚
â”‚ controller.enqueue(new Uint8Array(audioData))                   â”‚
â”‚ â†“                                                                â”‚
â”‚ è¾“å‡º: ReadableStream<Uint8Array>                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å®¢æˆ·ç«¯å‘é€ (WebSocketClient.js)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ èµ·å§‹å¸§: {                                                        â”‚
â”‚   voice_mode: 'BINARY',                                          â”‚
â”‚   audio_format: 'pcm'  â† âœ… æ˜ç¡®æŒ‡å®šæ ¼å¼                         â”‚
â”‚ }                                                                â”‚
â”‚ â†“                                                                â”‚
â”‚ äºŒè¿›åˆ¶å¸§: ws.send(value)  â† PCM æ•°æ®                            â”‚
â”‚ â†“                                                                â”‚
â”‚ ç»“æŸå¸§: {                                                        â”‚
â”‚   voice_mode: 'BINARY',                                          â”‚
â”‚   audio_format: 'pcm'  â† âœ… æ˜ç¡®æŒ‡å®šæ ¼å¼                         â”‚
â”‚ }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æœåŠ¡å™¨æ¥æ”¶ (agent_handler.py)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ èµ·å§‹å¸§ (stream_seq=0):                                           â”‚
â”‚   audio_format = content.get("audio_format", "pcm")  â† âœ… æå–   â”‚
â”‚   voice_buffer._format_hints[request_id] = audio_format  â† âœ… ä¿å­˜â”‚
â”‚ â†“                                                                â”‚
â”‚ äºŒè¿›åˆ¶å¸§:                                                        â”‚
â”‚   voice_buffer[request_id] += data  â† ç´¯ç§¯ PCM æ•°æ®             â”‚
â”‚ â†“                                                                â”‚
â”‚ ç»“æŸå¸§ (stream_seq=-1):                                          â”‚
â”‚   audio_format = voice_buffer._format_hints[request_id]  â† âœ… è·å–â”‚
â”‚   audio = voice_buffer[request_id]  â† å®Œæ•´ PCM æ•°æ®             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. è¯·æ±‚å¤„ç† (request_processor.py)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ process_voice_request(                                           â”‚
â”‚   audio_bytes=audio,                                             â”‚
â”‚   audio_format_hint='pcm'  â† âœ… ä¼ é€’æ ¼å¼                         â”‚
â”‚ )                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. STT æœåŠ¡ (stt_service.py)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ recognize_audio(audio_data, audio_format_hint='pcm')             â”‚
â”‚ â†“                                                                â”‚
â”‚ if audio_format_hint:                                            â”‚
â”‚   audio_format = 'pcm'  â† âœ… ä½¿ç”¨æç¤º                            â”‚
â”‚ else:                                                            â”‚
â”‚   audio_format = _detect_audio_format()  â† âŒ ä¸ä¼šæ‰§è¡Œ           â”‚
â”‚ â†“                                                                â”‚
â”‚ Recognition(                                                     â”‚
â”‚   format='pcm',  â† âœ… æ­£ç¡®æ ¼å¼                                   â”‚
â”‚   sample_rate=16000                                              â”‚
â”‚ )                                                                â”‚
â”‚ â†“                                                                â”‚
â”‚ response = recognition.call(audio_data)  â† âœ… ç›´æ¥ä¼ å…¥ PCM       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. DashScope SDK                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¥æ”¶: PCM è£¸æ•°æ® (16kHz/16bit/mono)                             â”‚
â”‚ â†“                                                                â”‚
â”‚ å¤„ç†: æ— æ ¼å¼è½¬æ¢ï¼Œç›´æ¥è¯†åˆ«                                       â”‚
â”‚ â†“                                                                â”‚
â”‚ è¾“å‡º: è¯†åˆ«æ–‡æœ¬                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…³é”®ä¼˜åŠ¿

### 1. æ ¼å¼æ˜ç¡®ä¼ é€’ âœ…
- å®¢æˆ·ç«¯åœ¨èµ·å§‹å¸§å’Œç»“æŸå¸§ä¸­æ˜ç¡®æŒ‡å®š `audio_format: 'pcm'`
- æœåŠ¡å™¨åœ¨èµ·å§‹å¸§æå–å¹¶ä¿å­˜æ ¼å¼
- ç»“æŸå¸§æ—¶ä½¿ç”¨ä¿å­˜çš„æ ¼å¼

### 2. é›¶æ ¼å¼è½¬æ¢ âœ…
- å®¢æˆ·ç«¯é‡‡é›†ï¼šPCM
- ç½‘ç»œä¼ è¾“ï¼šPCM
- æœåŠ¡å™¨æ¥æ”¶ï¼šPCM
- STT å¤„ç†ï¼šPCM
- DashScope SDKï¼šPCM
- **å…¨ç¨‹ PCMï¼Œæ— ä»»ä½•è½¬æ¢**

### 3. æ€§èƒ½æœ€ä¼˜ âœ…
- æ—  PCM â†’ WAV è½¬æ¢ï¼ˆèŠ‚çœ ~5msï¼‰
- æ— ä¸´æ—¶æ–‡ä»¶ I/Oï¼ˆèŠ‚çœ ~10msï¼‰
- æ—  SDK æ ¼å¼è§£ç ï¼ˆèŠ‚çœ ~15msï¼‰
- **æ€»å»¶è¿Ÿå‡å°‘ ~30ms**

### 4. å†…å­˜æœ€ä¼˜ âœ…
- ä»…ä¿ç•™ PCM æ•°æ®
- æ— é¢å¤–çš„ WAV æ•°æ®
- æ— ä¸´æ—¶æ–‡ä»¶ç¼“å­˜
- **å†…å­˜èŠ‚çœ ~66%**

---

## æµ‹è¯•éªŒè¯

### é¢„æœŸæ—¥å¿—è¾“å‡º

**å®¢æˆ·ç«¯**ï¼š
```
[WebSocket] å·²å‘é€èµ·å§‹å¸§ (PCM æ ¼å¼)
[WebSocket] å‘é€éŸ³é¢‘æ•°æ®å— 1 : 8192 å­—èŠ‚
[WebSocket] å‘é€éŸ³é¢‘æ•°æ®å— 2 : 8192 å­—èŠ‚
...
[WebSocket] å·²å‘é€ç»“æŸå¸§ (PCM æ ¼å¼)
```

**æœåŠ¡å™¨**ï¼š
```
[WS] [INFO] Voice stream started | {"request_id": "req_xxx", "audio_format": "pcm"}
[WS] [DEBUG] Received audio chunk | {"request_id": "req_xxx", "chunk_size": 8192, "total_size": 8192}
[WS] [DEBUG] Received audio chunk | {"request_id": "req_xxx", "chunk_size": 8192, "total_size": 16384}
...
[WS] [INFO] Voice stream ended | {"request_id": "req_xxx", "audio_size": 32000, "audio_format": "pcm"}
[STT] [INFO] Using provided audio format hint: pcm
[STT] [INFO] Starting speech recognition | {"audio_size": 32000, "format": "pcm", "note": "Using PCM for optimal performance"}
[STT] [INFO] Using PCM raw data for optimal performance (no format conversion)
[STT] [INFO] STT recognition response received | {"recognized_text": "ä½ å¥½"}
[STT] [INFO] STTè¯†åˆ«å®Œæˆ: ä½ å¥½
```

---

## æ•…éšœæ’æŸ¥

### å¦‚æœä»ç„¶è¯†åˆ«å¤±è´¥

1. **æ£€æŸ¥å®¢æˆ·ç«¯æ—¥å¿—**
   - ç¡®è®¤çœ‹åˆ° "å·²å‘é€èµ·å§‹å¸§ (PCM æ ¼å¼)"
   - ç¡®è®¤çœ‹åˆ° "å·²å‘é€ç»“æŸå¸§ (PCM æ ¼å¼)"

2. **æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—**
   - ç¡®è®¤çœ‹åˆ° "Voice stream started" ä¸” "audio_format": "pcm"
   - ç¡®è®¤çœ‹åˆ° "Voice stream ended" ä¸” "audio_format": "pcm"
   - ç¡®è®¤çœ‹åˆ° "Using provided audio format hint: pcm"

3. **æ£€æŸ¥éŸ³é¢‘æ•°æ®**
   - ç¡®è®¤ "audio_size" > 16000ï¼ˆè‡³å°‘ 0.5 ç§’ï¼‰
   - ç¡®è®¤ "Received audio chunk" æ—¥å¿—æ˜¾ç¤ºæ•°æ®æ­£åœ¨ç´¯ç§¯

4. **æ£€æŸ¥ API é…ç½®**
   - ç¡®è®¤ `config.json` ä¸­é…ç½®äº†æœ‰æ•ˆçš„ DashScope API å¯†é’¥
   - ç¡®è®¤ç½‘ç»œå¯ä»¥è®¿é—®é˜¿é‡Œäº‘ API

---

## æ€»ç»“

âœ… **å®¢æˆ·ç«¯ä¿®å¤**: åœ¨èµ·å§‹å¸§å’Œç»“æŸå¸§ä¸­æ·»åŠ  `audio_format: 'pcm'`  
âœ… **æœåŠ¡å™¨ä¿®å¤**: åœ¨èµ·å§‹å¸§æå–å¹¶ä¿å­˜æ ¼å¼ï¼Œç»“æŸå¸§æ—¶ä½¿ç”¨ä¿å­˜çš„æ ¼å¼  
âœ… **æ—¥å¿—å¢å¼º**: æ·»åŠ è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•  
âœ… **æ ¼å¼ç»Ÿä¸€**: å…¨æµç¨‹ PCM æ ¼å¼ï¼Œé›¶è½¬æ¢  
âœ… **æ€§èƒ½æœ€ä¼˜**: å»¶è¿Ÿæœ€ä½ï¼Œå†…å­˜æœ€å°  

**è¿™æ˜¯å®Œå…¨ç¬¦åˆ DashScope å®˜æ–¹æœ€ä½³å®è·µçš„å®ç°ï¼** ğŸ‰

