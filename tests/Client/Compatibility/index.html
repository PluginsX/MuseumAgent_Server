<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>博物馆智能体测试客户端</title>
    <link rel="stylesheet" href="./assets/css/style.css">
</head>
<body>
    <header>
        <h1>
            <span class="status-indicator" id="connectionStatus"></span>
            博物馆智能体测试客户端
        </h1>
        <div>
            <button class="btn btn-secondary" onclick="window.open(getCurrentServerUrl() + '/Control', '_blank')" style="margin-right: 10px;">管理面板</button>
            <button class="btn btn-secondary" onclick="window.open(getCurrentServerUrl() + '/docs', '_blank')" style="margin-right: 10px;">API文档</button>
            <span id="connectionText">未连接</span>
        </div>
    </header>

    <div class="container">
        <!-- 左侧面板：服务器和客户端配置 -->
        <aside class="panel left-panel">
            <div class="config-section">
                <h3>服务器配置</h3>
                <div class="form-group">
                    <label for="serverUrl">服务器地址 <span class="ssl-badge">支持HTTPS</span></label>
                    <input type="text" id="serverUrl" value="https://localhost:8000">
                </div>
                <div class="form-group">
                    <label for="timeout">请求超时(秒)</label>
                    <input type="number" id="timeout" value="30" min="5" max="120">
                </div>
                <button class="btn" onclick="testConnection()">测试连接</button>
                <button class="btn btn-secondary" onclick="clearChat()">清空对话</button>
            </div>

            <div class="config-section">
                <h3>客户端配置</h3>
                <div class="form-group">
                    <label for="clientType">客户端类型</label>
                    <select id="clientType" onchange="updateOperationPresets()">
                        <option value="test">测试客户端</option>
                        <option value="web3d">Web3D展示端</option>
                        <option value="spirit">器灵桌面宠物</option>
                        <option value="mobile">移动端</option>
                        <option value="api">API调用者</option>
                        <option value="custom">自定义</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="clientId">客户端ID</label>
                    <input type="text" id="clientId" placeholder="自动生成或手动输入">
                </div>
                <div class="form-group">
                    <label for="spiritId">器灵ID</label>
                    <input type="text" id="spiritId" placeholder="可选">
                </div>
                <div class="form-group">
                    <label for="sceneType">场景类型</label>
                    <select id="sceneType">
                        <option value="public">公共场景</option>
                        <option value="study">学习场景</option>
                        <option value="leisure">休闲场景</option>
                    </select>
                </div>
            </div>
        </aside>
        
        <!-- 分割线 -->
        <div class="divider vertical-divider" id="left-divider"></div>
        
        <!-- 中间面板：指令集配置 -->
        <section class="panel center-panel">
            <div class="config-section">
                <h3>函数定义配置 <span style="font-size: 0.8rem; color: #27ae60;">✨ OpenAI标准</span></h3>
                <div class="form-group">
                    <label for="functionModeToggle">模式选择</label>
                    <select id="functionModeToggle" onchange="toggleFunctionMode()">
                        <option value="with-functions">函数调用模式</option>
                        <option value="chat-only">普通对话模式</option>
                    </select>
                </div>
                
                <div id="functionDefinitionSection" class="form-group mode-container active">
                    <label for="functionDefinitions">函数定义 (OpenAI标准JSON格式)</label>
                    <textarea id="functionDefinitions" placeholder='[
  {
    "name": "introduce_artifact",
    "description": "介绍指定文物的详细信息",
    "parameters": {
      "type": "object",
      "properties": {
        "artifact_name": {
          "type": "string",
          "description": "文物名称"
        }
      },
      "required": ["artifact_name"]
    }
  },
  {
    "name": "move_to_position",
    "description": "移动到指定位置",
    "parameters": {
      "type": "object",
      "properties": {
        "x": {
          "type": "number",
          "description": "X坐标"
        },
        "y": {
          "type": "number",
          "description": "Y坐标"
        }
      },
      "required": ["x", "y"]
    }
  }
]'></textarea>
                    <div style="font-size: 0.7rem; color: #666; margin-top: 0.25rem;">
                        ⚠️ 函数定义是可选的，留空则使用普通对话模式
                    </div>
                </div>
                
                <div class="form-group">
                    <button class="btn" onclick="registerSession()" id="registerBtn">注册会话</button>
                    <button class="btn btn-secondary" onclick="loadSampleFunctions()" style="margin-left: 10px;">加载示例函数</button>
                </div>
                
                <div id="sessionInfo" style="display: none;">
                    <div style="background: #d5f4e6; padding: 0.5rem; border-radius: 4px; margin-top: 0.5rem;">
                        <strong>会话状态:</strong> <span id="sessionStatus">未注册</span><br>
                        <strong>会话ID:</strong> <span id="sessionIdDisplay">-</span><br>
                        <strong>过期时间:</strong> <span id="sessionExpiry">-</span>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- 分割线 -->
        <div class="divider vertical-divider" id="right-divider"></div>
        
        <!-- 右侧面板：聊天界面 -->
        <main class="panel right-panel chat-container">
            <div class="chat-header">
                <div>
                    <strong>智能体对话</strong>
                    <span style="font-size: 0.8rem; color: #666;">(测试模式)</span>
                </div>
                <div>
                    <button class="btn btn-danger" onclick="clearChat()">清空</button>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <!-- 消息将在这里动态添加 -->
            </div>

            <div class="chat-input">
                <div class="input-group">
                    <textarea 
                        id="userInput" 
                        placeholder="请输入您的问题，例如：讲讲蟠龙盖罍的纹样..." 
                        rows="3"></textarea>
                    <button class="btn" onclick="sendMessage()" id="sendBtn">发送</button>
                </div>
            </div>
        </main>
    </div>

    <script src="./assets/js/main.js"></script>
</body>
</html>