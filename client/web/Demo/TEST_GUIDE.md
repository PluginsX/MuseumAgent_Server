# Demo 升级测试指南

## 测试环境

1. 启动服务器：
```bash
cd E:\Project\Python\MuseumAgent_Server\client\web\Demo
python ssl_server.py
```

2. 访问地址：
```
https://localhost:8443
```

## 测试清单

### ✅ 阶段 1：Unity 文件提取
- [x] 运行 `extract-unity.bat`
- [x] 验证 `unity/` 目录已创建
- [x] 验证 Unity 文件已复制（Build/, StreamingAssets/, TemplateData/, main.js 等）

### ✅ 阶段 2：基础组件
- [x] 创建 `gesture.js` - 手势识别工具
- [x] 创建 `ControlButton.js` - 控制按钮组件
- [x] 创建 `FloatingPanel.js` - 悬浮面板基类
- [x] 创建 `UnityContainer.js` - Unity 容器组件

### ✅ 阶段 3：组件改造
- [x] 改造 `SettingsPanel.js` - 支持 FloatingPanel 模式
- [x] `ChatWindow.js` - 已支持容器模式，无需改造

### ✅ 阶段 4：应用入口
- [x] 重构 `app.js` - 登录后加载 Unity 视图
- [x] 扩展 `styles.css` - 添加新组件样式

### 🔄 阶段 5：功能测试

#### 5.1 登录流程
- [ ] 打开页面，显示登录界面
- [ ] 输入凭证，点击登录
- [ ] 登录成功后，应该加载 Unity WebGL（而不是聊天窗口）

#### 5.2 Unity 加载
- [ ] 显示加载进度条
- [ ] Unity 成功加载并全屏显示
- [ ] Unity Canvas 可以正常交互

#### 5.3 控制按钮
- [ ] 控制按钮显示在右下角
- [ ] 按钮为圆形，蓝色渐变背景
- [ ] 默认图标为麦克风 🎤

#### 5.4 单击功能
- [ ] 单击按钮开始录音
- [ ] 按钮图标变为 ⏹️
- [ ] 按钮背景变为红色，有脉冲动画
- [ ] 再次单击停止录音
- [ ] 按钮恢复默认状态

#### 5.5 拖拽功能
- [ ] 按住按钮并移动鼠标/手指
- [ ] 按钮跟随移动
- [ ] 按钮位置限制在页面范围内
- [ ] 释放后按钮停留在新位置

#### 5.6 长按功能
- [ ] 长按按钮（500ms）
- [ ] 弹出菜单（胶囊形状，垂直排列）
- [ ] 菜单包含两个图标按钮：⚙（设置）、✉（聊天）
- [ ] 菜单方向根据按钮位置自动调整（上/下）

#### 5.7 设置页面
- [ ] 点击菜单中的 ⚙ 图标
- [ ] 控制按钮隐藏
- [ ] 全屏显示设置页面
- [ ] 设置页面头部有全屏按钮和关闭按钮
- [ ] 点击关闭按钮
- [ ] 设置页面关闭，控制按钮恢复显示

#### 5.8 聊天页面
- [ ] 点击菜单中的 ✉ 图标
- [ ] 控制按钮隐藏
- [ ] 全屏显示聊天页面
- [ ] 聊天页面头部有全屏按钮和关闭按钮
- [ ] 聊天功能正常（发送文本、语音、接收消息）
- [ ] 点击关闭按钮
- [ ] 聊天页面关闭，控制按钮恢复显示

#### 5.9 智能体功能
- [ ] 通过控制按钮录音，发送语音消息
- [ ] 接收智能体的文本回复
- [ ] 接收智能体的语音回复（自动播放）
- [ ] 函数调用正常工作

#### 5.10 会话恢复
- [ ] 刷新页面
- [ ] 自动恢复会话
- [ ] 直接进入 Unity 视图（跳过登录）
- [ ] 控制按钮正常显示

#### 5.11 响应式测试
- [ ] 调整浏览器窗口大小
- [ ] 控制按钮大小自动调整
- [ ] 控制按钮位置保持在页面范围内
- [ ] Unity Canvas 自适应窗口大小

#### 5.12 移动端测试（可选）
- [ ] 在移动浏览器中打开
- [ ] 触控事件正常工作（单击、拖拽、长按）
- [ ] 控制按钮大小适配移动屏幕
- [ ] Unity WebGL 在移动端正常运行

## 已知问题

### 问题 1：Unity Loader 路径
- **现象**：Unity 加载失败，提示找不到 `build.loader.js`
- **原因**：路径配置错误
- **解决**：检查 `UnityContainer.js` 中的 `buildUrl` 配置

### 问题 2：控制按钮被 Unity 遮挡
- **现象**：控制按钮无法点击
- **原因**：z-index 层级问题
- **解决**：确保控制按钮的 z-index 高于 Unity Canvas

### 问题 3：菜单方向错误
- **现象**：菜单在屏幕边缘时显示不全
- **原因**：方向计算逻辑错误
- **解决**：检查 `ControlButton.js` 中的 `showMenu()` 方法

## 性能指标

- Unity 加载时间：< 10s（正常网络）
- 控制按钮响应时间：< 100ms
- 拖拽流畅度：>= 30fps
- 内存占用：< 500MB（桌面）

## 调试技巧

1. 打开浏览器开发者工具（F12）
2. 查看 Console 日志，关注以下标签：
   - `[App]` - 应用主流程
   - `[UnityContainer]` - Unity 加载
   - `[ControlButton]` - 控制按钮交互
   - `[FloatingPanel]` - 悬浮面板
   - `[SettingsPanel]` - 设置面板
   - `[ChatWindow]` - 聊天窗口

3. 检查网络请求：
   - Unity 资源加载（.data, .wasm, .framework.js）
   - WebSocket 连接状态
   - 音频数据传输

4. 检查元素层级：
   - 使用 Elements 面板查看 DOM 结构
   - 检查 z-index 值
   - 检查元素位置和大小

## 下一步

完成测试后，进入阶段 6：文档更新
- 更新 `Demo/README.md`
- 添加 Unity 集成说明
- 添加控制按钮使用说明

