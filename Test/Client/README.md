# 博物馆智能体测试客户端使用说明

## 🎯 新功能介绍

本次更新为测试客户端添加了**动态指令集配置**功能，支持模拟不同客户端的指令集能力。

## 🚀 主要新增功能

### 1. 客户端类型选择
- **Web3D展示端**: 支持 `zoom_pattern`, `restore_scene`, `introduce`, `query_param`
- **器灵桌面宠物**: 支持 `spirit_interact`, `introduce`, `query_param`  
- **移动端**: 支持 `introduce`, `query_param`
- **API调用者**: 支持所有指令
- **自定义**: 可自由配置指令集

### 2. 指令集配置模式

#### 预设模式
- 根据客户端类型自动加载对应的标准指令集
- 可手动勾选/取消勾选具体指令
- 适合快速测试标准场景

#### 自定义模式
- 可自由输入任意指令名称
- 每行一个指令，支持自定义指令集
- 适合测试特殊场景或新指令

### 3. 会话管理功能

#### 注册会话
- 将配置的指令集注册到服务端
- 获得唯一的会话ID
- 服务端将在该会话期间使用指定的指令集

#### 心跳维持
- 自动每5分钟发送心跳包
- 维持会话活跃状态
- 会话默认15分钟超时

#### 会话信息显示
- 实时显示会话状态
- 显示会话ID和过期时间
- 会话结束时自动清理

## 📋 使用步骤

### 步骤1: 配置客户端类型
1. 在左侧配置面板选择合适的客户端类型
2. 系统会自动加载对应的预设指令集

### 步骤2: 配置指令集
**预设模式下：**
- 查看自动加载的指令集
- 根据需要勾选/取消勾选指令

**自定义模式下：**
- 切换到自定义模式
- 在文本框中每行输入一个指令名称

### 步骤3: 预览和注册
1. 点击"预览指令集"查看当前配置
2. 确认无误后点击"注册会话"
3. 等待注册成功提示

### 步骤4: 开始测试
1. 在聊天区域输入测试消息
2. 系统将使用您配置的指令集进行解析
3. 查看返回的标准化指令

## 💡 使用示例

### 示例1: Web3D客户端测试
```
1. 客户端类型: Web3D展示端
2. 指令集模式: 预设模式
3. 勾选: zoom_pattern, restore_scene, introduce
4. 注册会话
5. 测试输入: "放大查看蟠龙盖罍的纹样"
6. 预期结果: LLM只会考虑zoom_pattern等3个指令
```

### 示例2: 自定义指令集测试
```
1. 客户端类型: 自定义
2. 指令集模式: 自定义模式
3. 输入指令:
   my_custom_op1
   my_custom_op2
   introduce
4. 注册会话
5. 测试输入: "测试自定义指令"
6. 预期结果: LLM只会考虑这3个自定义指令
```

## ⚠️ 注意事项

1. **会话时效性**: 会话默认15分钟超时，超时后需要重新注册
2. **指令集限制**: 注册后的会话只能使用注册时指定的指令集
3. **LLM行为**: 服务端会根据会话指令集动态调整提示词
4. **页面关闭**: 关闭页面时会自动注销会话

## 🔧 技术细节

### API调用流程
```
1. 会话注册: POST /api/session/register
2. 心跳维持: POST /api/session/heartbeat (带session_id头)
3. 指令解析: POST /api/agent/parse (带session_id头)
4. 会话注销: DELETE /api/session/unregister
```

### 请求头处理
- 注册会话后，所有后续请求都会自动添加 `session_id` 头
- 服务端根据session_id获取对应的指令集
- 无session_id时使用默认指令集

## 🎯 测试建议

1. **功能验证**: 测试不同类型客户端的指令集隔离
2. **边界测试**: 测试空指令集、超长指令集等边界情况
3. **性能测试**: 测试会话注册和心跳的性能表现
4. **兼容性测试**: 验证与现有功能的兼容性

这个增强版测试客户端为您提供了一个完整的动态指令集测试环境！